<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Required meta tags -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&family=Roboto+Mono:ital,wght@0,100..700;1,100..700&family=Roboto:ital,wght@0,100..900;1,100..900&family=Rubik:ital,wght@0,300..900;1,300..900&display=swap">
		<link rel="stylesheet" href="/tool/tool.css">
	</head>

	<body class="roboto-400">
		<header>
			<button type="button" onclick="save()">SAVE</button>
			<input type="file" id="load-input" value="load" hidden onchange="loading()">
			<button type="button" id="load-button" onclick="document.getElementById('load-input').click()">LOAD</button>
			<button type="reset" value="Reset" onclick="clearAll()">CLEAR</button>
		</header>

		<main>
			<input value="1" name="correction group count" id="correction-group-count" type="hidden">
			<input value="1" name="clarification count" id="clarification-count" type="hidden">
			<input value="1" name="credit count" id="credit-count" type="hidden">
			<input value="1" name="patreon count" id="patreon-count" type="hidden">
			<fieldset id="data">
					<row>
						<label>Video Title:</label>
						<input id="input-title" autocomplete="off">
					</row>
					<row>
						<label>Video URL:</label>
						<input id="input-url" autocomplete="off">
					</row>
					<row>
						<label>Nav ID:</label>
						<input id="input-nav-id" autocomplete="off">
					</row>
					<row>
						<label>Synopsis:</label>
						<input id="input-synopsis" autocomplete="off">
					</row>
					<corrections id="corrections">
						<div id="correction1-group">
							<div id="correction1-rows" class="rowgroup">
								<row>
									<label>Correction:</label>
									<input id="input-correction1-tcode1" autocomplete="off"><input id="input-correction1-details1" autocomplete="off">
								</row>
							</div>
							<row>
								<label>Correction credit:</label>
								<input id="input-correction1-credit" autocomplete="off">
							</row>
							<button-row id="correction-buttons">
								<button id="btn-correction1" class="add-new-button" value="1" onclick="addNewField('correction',1)">add correction</button>
								<button id="btn-correction1-group" class="add-new-button" value="1" onclick="addNewField('correction-group',1)">new correction group</button>
							</button-row>
						</div>
					</corrections>
					<row>
						<label>Clarifications:</label>
						<input id="input-clarification1" autocomplete="off">
					</row>
					<row>
						<label>Bandcamp Embed Code:</label>
						<input id="input-bandcamp" autocomplete="off">
					</row>
					<row>
						<label>Patreon Music Link:</label>
						<input id="input-patreon-music" autocomplete="off">
					</row>
					<div id="credit-container">
						<row>
							<label>Credit (name):</label>
							<input id="input-credit1-name" autocomplete="off">
						</row>
						<row>
							<label>Credit (role):</label>
							<input id="input-credit1-role" autocomplete="off">
						</row>
					</div>
					<button-row>
						<button id="btn-credit" class="add-new-button" onclick="addNewField('credit')">add credit</button>
					</button-row>
					<row>
						<label>Transcript:</label>
						<input id="input-transcript" autocomplete="off">
					</row>
					<row>
						<label>EN Captions:</label>
						<input id="input-en-captions" autocomplete="off">
					</row>
					<row>
						<label>EN Subtitles:</label>
						<input id="input-en-subtitles" autocomplete="off">
					</row>
					<div id="patreon-container">
						<row>
							<label>Patreon Image File:</label>
							<input id="input-patreon-image" autocomplete="off">
						</row>
						<row>
							<label>Patreon URL:</label>
							<input id="input-patreon1-url" autocomplete="off">
						</row>
						<row>
							<label>Patreon Title:</label>
							<input id="input-patreon1-title" autocomplete="off">
						</row>
						<row>
							<label>Patreon Duration:</label>
							<input id="input-patreon1-duration" autocomplete="off">
						</row>
					</div>
					<button-row>
						<button id="btn-patreon" class="add-new-button" onclick="addNewField('patreon')">add reward</button>
					</button-row>
					<row>
						<label>Next Page Title:</label>
						<input id="input-next-title" autocomplete="off">
					</row>
					<row>
						<label>Next Page Link:</label>
						<input id="input-next-link" autocomplete="off">
					</row>
					<row>
						<label>Previous Page Title:</label>
						<input id="input-prev-title" autocomplete="off">
					</row>
					<row>
						<label>Previous Page Link:</label>
						<input id="input-prev-link" autocomplete="off">
					</row>
			</fieldset>
		</main>

		<div class="processing hidden" role="status" id="processing">
			Processing ...
		</div>

<!-- SCRIPTING -->

		<script>
		<div id="import-confirmation" class="hidden" style="text-align: center; color: white; padding: 1rem 0">
			sources imported: 
		</div>

		<footer>
			<input type="file" id="export-with-source" value="export-with-source" hidden onchange="exportHTMLwithSources()">
			<button type="button" onclick="document.getElementById('export-with-source').click();">Attach Sources and Export</button>
		</footer>
	</body>

		let xSources, iSources = [], mSources = [], load = [], fileImport, file, reader;
		let fileName = "page-data--.txt", clipboardHTML = "";
		let srcCountI, srcCountM;
		let iURL = 0, iTitle = 1, iPub = 2, iAuthor = 3, iYear = 4, iSpecifics = 5, iSpecificsURL = 6, iAccessed = 7, iClaim = 8, iTimecode = 9, iLinkState = 11, iLinks = 12;
		let mURL = 0, mTitle = 1, mPub = 2, mAuthor = 3, mYear = 4, mMods = 6, mTimecode = 7;
		let diag = true;

		function save() {
			console.log("... SAVE PRESSED");
			document.getElementById("processing").classList.remove("hidden");

			let dataCollect = collectData();

			// take info from data and write it to a txt file
			let dataString = JSON.stringify(dataCollect);
			let file = new Blob([dataString],{type:"text"});
			let anchor = document.createElement("a");
			anchor.href = URL.createObjectURL(file);
			anchor.download = fileName;
			anchor.click();

			document.getElementById("processing").classList.add("hidden");
			console.log("/// SAVE DONE");
		}

		function collectData() {
			try {
				let data = [], vidInfo = [], vidCorrections = [], vidClarifications = [], vidMusic = [], vidCredits = [], vidCaptions = [], vidPatreon = [], nav = [];

				vidInfo.push(document.getElementById("input-title").value);
				vidInfo.push(document.getElementById("input-url").value);
				vidInfo.push(document.getElementById("input-nav-id").value);
				vidInfo.push(document.getElementById("input-synopsis").value);
				vidMusic.push(document.getElementById("input-bandcamp").value);
				vidMusic.push(document.getElementById("input-patreon-music").value);
				vidCaptions.push(document.getElementById("input-transcript").value);
				vidCaptions.push(document.getElementById("input-en-captions").value);
				vidCaptions.push(document.getElementById("input-en-subtitles").value);
				vidPatreon.push(document.getElementById("input-patreon-image").value);
				nav.push(document.getElementById("input-next-title").value)
				nav.push(document.getElementById("input-next-link").value)
				nav.push(document.getElementById("input-prev-title").value)
				nav.push(document.getElementById("input-prev-link").value)
				diag && console.log("| finished push block");

				let correctionGroupCount = Number.parseInt(document.getElementById("correction-group-count").value);
				let clarificationCount = Number.parseInt(document.getElementById("clarification-count").value);
				let creditCount = Number.parseInt(document.getElementById("credit-count").value);
				let patreonCount = Number.parseInt(document.getElementById("patreon-count").value);
				diag && console.log("| defined terms");

				diag && console.log("| correctionGroupCount: " + correctionGroupCount);
				for (g = 1; g < (correctionGroupCount + 1); g++) {
					diag && console.log("| started corrections");
					diag && console.log("| g: " + g);
					let entries = Number(document.getElementById(`btn-correction${g}`).value);
					diag && console.log("| 1");
					let credit = document.getElementById(`input-correction${g}-credit`).value;
					diag && console.log("| 2");
					let group = [];

					for (e = 1; e < entries + 1; e++) {
						diag && console.log("| 3");
						let eTcode = document.getElementById(`input-correction${g}-tcode${e}`).value;
						if (eTcode == null) { eTcode = "0:00" };
						let eDetails = document.getElementById(`input-correction${g}-details${e}`).value;
						group.push(eTcode);
						group.push(eDetails);
					}
					diag && console.log("| 4");
					group.push(credit);
					diag && console.log("| 5");
					vidCorrections.push(group);
					diag && console.log("| 6");
				}
				
				diag && console.log("| 7");
				for (j = 1; j < (clarificationCount + 1); j++) {
					diag && console.log("| started clarifications");
					vidClarifications.push(document.getElementById(`input-clarification${j}`).value);
				}
				for (k = 1; k < (creditCount + 1); k++) {
					diag && console.log("| started credits");
					vidCredits.push(document.getElementById(`input-credit${k}-name`).value);
					vidCredits.push(document.getElementById(`input-credit${k}-role`).value);
				}
				for (l = 1; l < (patreonCount + 1); l++) {
					diag && console.log("| started patreon posts");
					vidPatreon.push(document.getElementById(`input-patreon${l}-url`).value);
					vidPatreon.push(document.getElementById(`input-patreon${l}-title`).value);
					vidPatreon.push(document.getElementById(`input-patreon${l}-duration`).value);
				}

				data.push(vidInfo, vidCorrections, vidClarifications, vidMusic, vidCredits, vidCaptions, vidPatreon, nav);

				return data;
			} catch(err) {
				console.log(">!< ERROR: " + err);
			}
		}

			function clearAll() {
				var elements = document.getElementsByTagName("input");
				for (e = 0; e < elements.length; e++) {
					if (elements[e].type == "text") {
						elements[e].value = "";
		function loading() {
			console.log("... LOADING PRESSED");
			document.getElementById("processing").classList.remove("hidden");
			clearAll();
			file = document.getElementById("load-input").files[0];
			fileName = file.name;
			reader = new FileReader();
			reader.onloadend = function(){
				load = JSON.parse(reader.result);

				document.getElementById("input-title").value = load[0][0];
				document.getElementById("input-url").value = load[0][1];
				document.getElementById("input-nav-id").value = load[0][2];
				document.getElementById("input-synopsis").value = load[0][3];
				document.getElementById("input-bandcamp").value = load[3][0];
				document.getElementById("input-patreon-music").value = load[3][1];
				document.getElementById("input-transcript").value = load[5][0];
				document.getElementById("input-en-captions").value = load[5][1];
				document.getElementById("input-en-subtitles").value = load[5][2];
				document.getElementById("input-patreon-image").value = load[6][0];
				document.getElementById("input-next-title").value = load[7][0];
				document.getElementById("input-next-link").value = load[7][1];
				document.getElementById("input-prev-title").value = load[7][2];
				document.getElementById("input-prev-link").value = load[7][3];

				let correctionGroupCount = load[1].length;
				let clarificationCount = load[2].length;
				let creditCount = load[4].length / 2;
				let patreonCount = (load[6].length - 1) / 3;
				console.log("# group count: " + correctionGroupCount);

				// add +1 to for loop when correction groups are accounted for
				for (a = 1; a < correctionGroupCount + 1; a++) {
					console.log("# group (a): " + a);
					if (a > 1) { addNewField("correction-group", a - 1) }
					let entries = (load[1][a-1].length - 1) / 2;
					console.log("# group entries: " + entries);
					for (e = 1; e < entries + 1; e++) {
						console.log("# entry: " + e);
						if (e > 1) { addNewField("correction", a) }
						console.log("# time: " + load[1][a-1][(e * 2) - 2]);
						document.getElementById(`input-correction${a}-tcode${e}`).value = load[1][a-1][(e * 2) - 2];
						console.log("# details: " + load[1][a-1][(e * 2) - 1]);
						document.getElementById(`input-correction${a}-details${e}`).value = load[1][a-1][(e * 2) - 1];
					}
					console.log("# credit: " + load[1][a-1][load[1][a-1].length - 1]);
					document.getElementById(`input-correction${a}-credit`).value = load[1][a-1][load[1][a-1].length - 1];
				}
				refreshCounts();
			}

			function refreshCounts() {
				let correctionCount = document.getElementById("correction-group-count");
				for (i = 1; i < Number.parseInt(correctionCount.value + 1); i++) {
					if (document.getElementById(`input-correction${i}`)) {correctionCount.value = i;}
				for (b = 1; b < clarificationCount + 1; b++) {
					if (b > 1) { addNewField("clarification") }
					document.getElementById(`input-clarification${b}`).value = load[2][b - 1];
				}
				let clarificationCount = document.getElementById("clarification-count");
				for (j = 1; j < Number.parseInt(clarificationCount.value + 1); j++) {
					if (document.getElementById(`input-clarification${j}`)) {clarificationCount.value = j;}
				for (c = 1; c < creditCount + 1; c++) {
					if (c > 1) { addNewField("credit") }
					let nameNum = c * 2 - 2;
					let roleNum = c * 2 - 1;
					document.getElementById(`input-credit${c}-name`).value = load[4][nameNum];
					document.getElementById(`input-credit${c}-role`).value = load[4][roleNum];
				}
				let creditCount = document.getElementById("credit-count");
				for (k = 1; k < Number.parseInt(creditCount.value + 1); k++) {
					if (document.getElementById(`input-credit${k}-name`)) {creditCount.value = k;}
				for (d = 1; d < patreonCount + 1; d++) {
					if (d > 1) { addNewField("patreon") }
					let urlNum = d * 3 - 2;
					let titleNum = d * 3 - 1;
					let durationNum = d * 3;
					document.getElementById(`input-patreon${d}-url`).value = load[6][urlNum];
					document.getElementById(`input-patreon${d}-title`).value = load[6][titleNum];
					document.getElementById(`input-patreon${d}-duration`).value = load[6][durationNum];
				}
				let patreonCount = document.getElementById("patreon-count");
				for (p = 1; p < Number.parseInt(patreonCount.value + 1); p++) {
					if (document.getElementById(`input-patreon${p}-url`)) {patreonCount.value = p;}
			};
			reader.readAsText(file);

			document.getElementById("processing").classList.add("hidden");
			console.log("/// LOADING DONE");
		}
				}
			}

			}
		function toTopFunction() {
			let topButton = document.getElementById("to-top-button");
			document.body.scrollTop = 0; // For Safari
			document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
		}

		function addListeners(src, t, rows) {
			if (t == "i") {
				document.getElementById(t + src + "-AddInst").addEventListener("click", addInstance.bind(this, src, t) );
				document.getElementById(t + src + "-RmvInst").addEventListener("click", removeInstance.bind(this, src, t) );
				document.getElementById(t + src + "-Bulk").addEventListener("click", removeAllInstances.bind(this, src, t) );
				if (src != 1) {document.getElementById(t + src + "-Link").addEventListener("click", linkSource.bind(this, src, t) ); };
				document.getElementById(t + src + "-Unlink").addEventListener("click", unlinkSource.bind(this, src, t) );
				if (rows < 12) {
					document.getElementById(t + src + "F6").addEventListener("input", function(e) {
						if (e.target.value == "") {
							document.getElementById(t + src + "URL7").classList.add("hidden");
						} else {
							document.getElementById(t + src + "URL7").classList.remove("hidden");
						}
					});
				} else {
					let instCount = (rows - 8) / 4;
					for (x = 0; x < instCount; x++) {
						let r;
						if (x == 0) {r = 7} else {r = 8 + (4 * x)}
						document.getElementById(t + src + "F" + r).addEventListener("input", function(e) {
							if (e.target.value == "") {
								document.getElementById(t + src + "URL" + (r + 1)).classList.add("hidden");
							} else {
								document.getElementById(t + src + "URL" + (r + 1)).classList.remove("hidden");
							}
						});
					}
				}
			}
			
			document.getElementById(t + src + "-Clear").addEventListener("click", clearInputs.bind(this, src, t) );
			document.getElementById(t + src + "-Reorder").addEventListener("click", reorderToggle.bind(this, src, t) );
			document.getElementById(t + src + "-ReorderConfirm").addEventListener("click", pushOrder.bind(this, src, t) );
			document.getElementById(t + src + "-Delete").addEventListener("click", deleteSource.bind(this, src, t) );
		}

		function exportHTML(state) {
			console.log("... EXPORT HTML PRESSED, STATE: " + state);

			try {
				document.getElementById("processing").classList.remove("hidden");

				let clipboardHTML = buildHead();
				clipboardHTML += buildHeaderWithNav();
				clipboardHTML += buildVidWithSynopsis();
				clipboardHTML += buildCorrections();
				clipboardHTML += buildClarifications();
				if (!state == false) { clipboardHTML += buildSources() }
				clipboardHTML += buildMusic();
				clipboardHTML += buildCredits();
				clipboardHTML += buildTranscript();
				clipboardHTML += buildBonus();
				clipboardHTML += `\n${tabs(2)}</main>`;
				clipboardHTML += buildFooter();
				clipboardHTML += buildScript();

				navigator.clipboard.writeText(clipboardHTML); // copy to clipboard

				let confirm = document.getElementById("import-confirmation");
				confirm.classList.remove("hidden");
				confirm.innerText = "sources imported: " + fileName;
				
				alert("HTML successfully copied!");
				document.getElementById("processing").classList.add("hidden");
			} catch(err) {
				console.log(">!< ERROR: " + err.message);
			}

			console.log("/// EXPORT HTML DONE");
		}

		function exportHTMLwithSources() {
			console.log("... IMPORTING SOURCES");
			let fileImport = document.getElementById("export-with-source").files[0];
			fileName = fileImport.name;
			let reader = new FileReader();
			reader.onloadend = function(){
				file = JSON.parse(reader.result);
				exportHTML(true);
				diag && console.log("| file: " + file);
			}

			reader.readAsText(fileImport);
		}

		function buildHead() {
			diag && console.log("| building head");
			let output =
				`<!DOCTYPE html>` +
				`\n<html lang="en">` +
				`\n${tabs(1)}<head>` +
				`\n${tabs(2)}<meta charset="utf-8">` +
				`\n${tabs(2)}<meta name="viewport" content="width=device-width, initial-scale=1">` +
				`\n${tabs(2)}<link rel="preconnect" href="https://fonts.googleapis.com">` +
				`\n${tabs(2)}<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>` +
				`\n${tabs(2)}<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:ital,wght@0,100..900;1,100..900&family=Roboto+Mono:ital,wght@0,100..700;1,100..700&family=Roboto:ital,wght@0,100..900;1,100..900&family=Rubik:ital,wght@0,300..900;1,300..900&display=swap">` +
				`\n${tabs(2)}<link rel="stylesheet" href="/styles/main.css">` +
				`\n${tabs(2)}<link rel="stylesheet" href="/styles/video-solo.css">` +
				`\n${tabs(2)}<script type="text/javascript" src="/color-palettes.js" defer><\/script>` +
				`\n${tabs(1)}</head>\n`;

			return output;
		}

		function buildHeaderWithNav() {
			diag && console.log("| building header with nav");
			let title = document.getElementById("input-title").value;
			let navID = document.getElementById("input-nav-id").value;
			let output =
				`\n${tabs(1)}<body>` +
				`\n${tabs(2)}<nav class="nav-desktop">` +
				`\n${tabs(3)}<span><a href="/home.html">/ home</a> <a href="/videos.html">/ videos</a> / ${navID}.html</span>` +
				`\n${tabs(2)}</nav>\n`;

			output +=
				`\n${tabs(2)}<main>` +
				`\n${tabs(3)}<header class="content-column">` +
				`\n${tabs(4)}<nav class="nav-mobile">` +
				`\n${tabs(5)}<span><a href="/home.html">/ home</a></span>` +
				`\n${tabs(5)}<span><a href="/videos.html">/ videos</a></span>` +
				`\n${tabs(5)}<span><a href="/music.html">/ music</a></span>` +
				`\n${tabs(5)}<span>/ ${navID}.html</span>` +
				`\n${tabs(4)}</nav>\n` +
				`\n${tabs(4)}<button id="theme">` +
					`\n${tabs(5)}<svg id="theme1" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e3e3e3"><path d="M380-880q83 0 156 31.5T663-763q54 54 85.5 127T780-480q0 83-31.5 156T663-197q-54 54-127 85.5T380-80q-53 0-103.5-13.5T180-134q93-54 146.5-146T380-480q0-108-53.5-200T180-826q46-27 96.5-40.5T380-880Z"/></svg>` +
					`\n${tabs(5)}<svg id="theme2" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e3e3e3"><path d="M480-280q-83 0-141.5-58.5T280-480q0-83 58.5-141.5T480-680q83 0 141.5 58.5T680-480q0 83-58.5 141.5T480-280ZM200-440H40v-80h160v80Zm720 0H760v-80h160v80ZM440-760v-160h80v160h-80Zm0 720v-160h80v160h-80ZM256-650l-101-97 57-59 96 100-52 56Zm492 496-97-101 53-55 101 97-57 59Zm-98-550 97-101 59 57-100 96-56-52ZM154-212l101-97 55 53-97 101-59-57Z"/></svg>` +
					`\n${tabs(5)}<svg id="theme3" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#e3e3e3"><path d="M480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm40-83q119-15 199.5-104.5T800-480q0-123-80.5-212.5T520-797v634Z"/></svg>` +
				`\n${tabs(4)}</button>` +
				`\n${tabs(3)}</header>\n`;

			return output;
		}

		function buildVidWithSynopsis() {
			diag && console.log("| building video and synopsis");
			let title = document.getElementById("input-title").value;
			let synopsis = document.getElementById("input-synopsis").value;
			let output =
				`\n${tabs(3)}<h1>${title}</h1>` +
				`\n${tabs(3)}<video id="yt-player"></video>` +
				`\n\n${tabs(3)}<synopsis>` +
				`\n${tabs(4)}${synopsis}` +
				`\n${tabs(3)}</synopsis>`;

			return output;
		}

		function buildCorrections() {
			diag && console.log("| building corrections");
			if (!document.getElementById(`input-correction1-details1`).value) { return "" }
			let groups = Number(document.getElementById("correction-group-count").value);
			let output = `\n` +
				`\n${tabs(3)}<corrections>` +
				`\n${tabs(4)}<h4>CORRECTIONS</h4>`;

			diag && console.log("# groups: " + groups);
			for (g = 1; g < groups + 1; g++) {
				diag && console.log("# group " + g + " started");
				let entries = Number(document.getElementById(`btn-correction${g}`).value);
				let credit = document.getElementById(`input-correction${g}-credit`).value;

				output +=
					`\n${tabs(4)}<ul>`;

				for (e = 1; e < entries + 1; e++) {
					diag && console.log("# entry " + e + " of group " + g + " started");
					let eTcode = document.getElementById(`input-correction${g}-tcode${e}`).value;
					if (eTcode == null) { eTcode = "0:00" }
					let eTcodeSec = Number(eTcode.slice(-2)) + (Number(eTcode.slice(0,eTcode.length-3)) * 60);
					let eDetails = document.getElementById(`input-correction${g}-details${e}`).value;
					output +=
						`\n${tabs(5)}<li><a class="roboto-mono-400" href="#" onclick="playerSeekTo(player, ${eTcodeSec}); return false;">${eTcode}</a> ${eDetails}</li>`;
				}

				output +=
					`\n${tabs(5)}<span>(reported by ${credit})</span>` +
					`\n${tabs(4)}</ul>`;
				diag && console.log("# credit written");
			}
			diag && console.log("# outputting");
			output += `\n${tabs(3)}</corrections>`;
			return output;
		}

		function buildClarifications() {
			diag && console.log("| building clarifications");
			if (!document.getElementById(`input-clarification1`).value) { return "" }
			let clarificationInput = document.getElementById("input-clarification1").value;
			let output = `\n` +
				`\n${tabs(3)}<clarifications>` +
				`\n${tabs(4)}<h4>CLARIFICATIONS</h4>` +
				`\n${tabs(4)}<ul>` +
				`\n${tabs(5)}<li>${clarificationInput}</li>` +
				`\n${tabs(4)}</ul>` +
				`\n${tabs(3)}</clarifications>`;

			return output;
		}
				return output;
			}

			function buildSources() {
				try {
					diag && console.log("| building sources");
					let srcCountI = file[0].length;
					let srcCountM = file[1].length;
					let iURL = 0, iTitle = 1, iPub = 2, iAuthor = 3, iYear = 4, iSpecifics = 5, iSpecificsURL = 6, iAccessed = 7, iClaim = 8, iTimecode = 9, iLinkState = 11, iLinks = 12;
					let mURL = 0, mTitle = 1, mPub = 2, mAuthor = 3, mYear = 4, mMods = 6, mTimecode = 7;
					let vidLink = file[0][0][0];

					let output = `\n\n${tabs(3)}<div class="cite-info">`

					if (srcCountI) {
						diag && console.log("| srcCountI detected");
						output +=
							`\n${tabs(4)}<h2 class="section-title inewspaper">Info Sources</h2>` +
							`\n${tabs(4)}<div class="source-container islate" id="infoContainer">`;

						// loop through info data, source by source
						let linkedChildren = 0;
						for (srcI = 0; srcI < srcCountI; srcI++) {
							let s = srcI + 1;
							let rowTotal = file[0][srcI].length - 2;
							let tcode;
							if (file[0][srcI][iTimecode] == null) {
								tcode = "0:00"
							} else {
								tcode = file[0][srcI][iTimecode]
							}
							let tcodeSeconds = Number(tcode.slice(-2)) + (Number(tcode.slice(0,tcode.length-3)) * 60);
							let part = "ABCDEFGHIJKLMNO";
							let instCount = (rowTotal - 8) / 4;
							let specifics = "";
							let instSpecifics = file[0][srcI][iSpecifics];
							let instSpecificsURL = file[0][srcI][iSpecificsURL];
							let sLinkState = file[0][srcI][iLinkState];
							let sLinks = Number(file[0][srcI][iLinks]);
							let displayURL = urlSanitize(file[0][srcI][iURL]);

							// if this source isn't a child in a link chain
							// create a box for the claim and source number 
							if (linkedChildren == 0) {
								diag && console.log(file[0][srcI]);
								if (sLinks > 0) {
									linkedChildren = sLinks;
									output += `\n${tabs(5)}<div class="info-number" id="Info${s}">${s}`;
										for (sX = 1; sX < sLinks + 1; sX++){
											output += ", " + (s + sX);
										}
										output += `</div>`;
								} else {
									output += `\n${tabs(5)}<div class="info-number" id="Info${s}">${s}</div>`;
								}
							
								if (rowTotal < 12) {
									if (instSpecifics && instSpecificsURL) {
										specifics = `<a href="${instSpecificsURL}">${instSpecifics}</a>`;
									} else {
										specifics = instSpecifics;
									}

									output +=
										`\n${tabs(5)}<div class="cite-box">` +
										`\n${tabs(6)}${file[0][srcI][iClaim]}<br>` +
										`\n${tabs(6)}<span class="timecode">timecode <a href="#" class="roboto-mono-400" onclick="playerSeekTo(player, ${tcodeSeconds}); return false;">${tcode}</a></span>` +
										`\n${tabs(5)}</div>`;
								} else {
									for (x = 0; x < instCount; x++) {
										let instClaim, instTime;

										if (x == 0) {
											if (instSpecifics && instSpecificsURL) {
												specifics = part[x] + ": " + "<a href=\"" + instSpecificsURL + "\">" + instSpecifics + "</a>";
											} else if (instSpecifics) {
												specifics = part[x] + ": " + instSpecifics;
											};
											if (file[0][srcI][iClaim]) {
												instClaim = file[0][srcI][iClaim];
											} else {
												instClaim = "No specific claim."
											}
											instTime = tcode;
										} else {
											if (file[0][srcI][7 + (x * 4)] && file[0][srcI][8 + (x * 4)]) {
												if (specifics.length > 0) { specifics += "<br>" };
												specifics += part[x] + ": " + "<a href=\"" + file[0][srcI][8 + (x * 4)] + "\">" + file[0][srcI][7 + (x * 4)] + "</a>";
											} else if (file[0][srcI][7 + (x * 4)]) {
												if (specifics.length > 0) { specifics += "<br>" };
												specifics += part[x] + ": " + file[0][srcI][7 + (x * 4)];
											};
											if (file[0][srcI][9 + (x * 4)]) {
												instClaim = file[0][srcI][9 + (x * 4)];
											} else {
												instClaim = "No specific claim."
											}
											instTime = file[0][srcI][10 + (x * 4)];
										}

										output +=
											`\n${tabs(5)}<div class="cite-tab-align">` +
											`\n${tabs(6)}<div class="cite-box-multi-tab">${part[x]}</div>` +
											`\n${tabs(6)}<div class="cite-box-multi-quote">` +
											`\n${tabs(7)}${instClaim}<br>` +
											`\n${tabs(7)}<span class="timecode">timecode <a href="#" class="roboto-mono-400" onclick="playerSeekTo(player, ${tcodeSeconds}); return false;">${instTime}</a></span>` +
											`\n${tabs(6)}</div>` +
											`\n${tabs(5)}</div>`;
									}
								}
							} else { linkedChildren-- }

							output +=
								`\n${tabs(5)}<div class="cite-details">` +
								`\n${tabs(6)}<span class="cite-identifier">${file[0][srcI][iTitle]}<br></span>` +
								`\n${tabs(6)}<span class="cite-credits">`;

							if (file[0][srcI][iYear]) {output += `\n${tabs(7)}${file[0][srcI][iYear]}`};
							if (file[0][srcI][iYear] && file[0][srcI][iAuthor] || file[0][srcI][iYear] && file[0][srcI][iPub]) {output += ", "};
							if (file[0][srcI][iAuthor]) {output += file[0][srcI][iAuthor] + "<br>"};
							if (file[0][srcI][iPub]) {output += `\n${tabs(6)}${file[0][srcI][iPub]}<br>`};
							if (file[0][srcI][iAccessed]) {output += `\n${tabs(6)}accessed ${file[0][srcI][iAccessed]}<br>`};
							if (specifics) {output += `\n${tabs(7)}${specifics}`};
							output += `\n${tabs(6)}</span>`;
							if (file[0][srcI][iURL]) {
								output +=
									`\n${tabs(6)}<div class="source-link roboto-mono-400">` +
									`\n${tabs(7)}<a href="${file[0][srcI][iURL]}">${displayURL}</a>` +
									`\n${tabs(6)}</div>` +
									`\n${tabs(5)}</div>`;
							};
						};
					};

					output += `\n${tabs(4)}</div>`;

					if (srcCountI > 2) {
						output +=
							`\n${tabs(4)}<form class="search-banner" id="infoSearchBanner">` +
							`\n${tabs(5)}<input id="infoInput" class="search-input" placeholder="#" onfocus="this.value=''">` +
							`\n${tabs(5)}<button id="infoBtn" class="search-button" type="button" onclick="infoSearch()">go to</button>` +
							`\n${tabs(4)}</form>`;
					}

					output += `\n${tabs(3)}</div>`;

					if (srcCountM) {
						diag && console.log("| srcCountM detected");
						output += `\n` +
							`\n${tabs(3)}<div class="cite-media">` +
							`\n${tabs(4)}<h2 class="section-title inewspaper">Media Sources</h2>` +
							`\n${tabs(4)}<div class="source-container islate" id="media-container">`;
						
						// loop through media data, source by source
						for (srcM = 0; srcM < srcCountM; srcM++) {
							let s = srcM + 1;
							let rowTotal = file[1][srcM].length;
							let tcode;
							if (file[1][srcM][mTimecode] == null) {
								tcode = "0:00"
							} else {
								tcode = file[1][srcM][mTimecode]
							}

							let tcodeSeconds = Number(tcode.slice(-2)) + (Number(tcode.slice(0,tcode.length-3)) * 60);
							let displayURL = urlSanitize(file[1][srcM][mURL]);

							output +=
								`\n${tabs(5)}<div id="Media${s}">` +
								`\n${tabs(6)}<div class="media-anchor">` +
								`\n${tabs(7)}<a class="media-time roboto-mono-400" href="#" onclick="playerSeekTo(player, ${tcodeSeconds}); return false;">${tcode}</a><span class="inewspaper media-indx">m${s}</span>` +
								`\n${tabs(6)}</div>` +
								`\n${tabs(6)}<div class="cite-details">` +
								`\n${tabs(7)}<span class="cite-identifier">${file[1][srcM][mTitle]}<br></span>` +
								`\n${tabs(7)}<span class="cite-credits">`;

							if (file[1][srcM][mYear]) {output += `\n${tabs(8)}${file[1][srcM][mYear]}`};
							if (file[1][srcM][mYear] && file[1][srcM][mAuthor]) {output += ", "};
							if (file[1][srcM][mAuthor]) {output += file[1][srcM][mAuthor] + "<br>"};
							if (file[1][srcM][mPub]) {output += `\n${tabs(8)}${file[1][srcM][mPub]}<br>`};
							if (file[1][srcM][mMods]) {output += `\n${tabs(8)}<i>modifications: ${file[1][srcM][mMods]}</i><br>`};

							output += `\n${tabs(7)}</span>`;
							if (file[1][srcM][mURL]) {
								output +=
									`\n${tabs(7)}<div class="source-link roboto-mono-400">` +
									`\n${tabs(8)}<a href="${file[1][srcM][mURL]}">${displayURL}</a>` +
									`\n${tabs(7)}</div>`;
							};
							output +=
								`\n${tabs(6)}</div>` +
								`\n${tabs(5)}</div>`;
						};
					};

					output += `\n${tabs(4)}</div>`;

					if (srcCountM > 2) {
						output +=
							`\n${tabs(4)}<form class="search-banner" id="mediaSearchBanner">` +
							`\n${tabs(5)}<input id="mediaInput" class="search-input" placeholder="#" onfocus="this.value=''">` +
							`\n${tabs(5)}<button id="mediaBtn" class="search-button" type="button" onclick="mediaSearch()">go to</button>` +
							`\n${tabs(4)}</form>`;
					}

					output += `\n${tabs(3)}</div>`;
					return output;
				} catch(err) {
					console.log(">!< ERROR, buildSources: " + err);
				}
			}


		function buildMusic() {
			diag && console.log("| building music");
			let bandcampEmbed = document.getElementById("input-bandcamp").value;
			let bandcampID = bandcampEmbed.split(`/album=`).pop().split(`/size=`)[0];
			let bandcampLink = bandcampEmbed.split(`href="`).pop().split(`">`)[0];
			let bandcampTitle = bandcampEmbed.split(`">`).pop().split(`</a></iframe>`)[0];
			let patreonMusic = document.getElementById("input-patreon-music").value;
			let output = `\n` +
				`\n${tabs(3)}<music>` +
				`\n${tabs(4)}<h2>Music</h2>` +
				`\n${tabs(4)}<iframe id="bandcamp-player" src="https://bandcamp.com/EmbeddedPlayer/album=${bandcampID}/size=large/bgcol=333333/linkcol=6decc2/artwork=small/transparent=true/" seamless><a href="${bandcampLink}">${bandcampTitle}</a></iframe>` +
				`\n${tabs(4)}<download>` +
				`\n${tabs(5)}available on all major platforms<br>` +
				`\n${tabs(5)}<button type="button" onclick="document.location='/music/${document.getElementById(`input-nav-id`).value}.html'" value="Go to music details page.">buy or stream</button>` +
				`\n${tabs(4)}</download>` +
				`\n${tabs(3)}</music>`;

			return output;
		}

		function buildCredits() {
			diag && console.log("| building credits");
			let output = `\n` +
				`\n${tabs(3)}<credits>` +
				`\n${tabs(4)}<h2>Credits</h2>` +
				`\n${tabs(4)}<container>` +
				`\n${tabs(5)}<p>`;
			let creditCount = Number.parseInt(document.getElementById("credit-count").value);
			for (cr = 1; cr < (creditCount + 1); cr++) {
				let creditName = document.getElementById(`input-credit${cr}-name`).value;
				let creditRole = document.getElementById(`input-credit${cr}-role`).value;
				output +=
					`\n${tabs(6)}<credit-name>${creditName}</credit-name>` +
					`\n${tabs(6)}<credit-role>${creditRole}</credit-role>`;
			}
			output +=
				`\n${tabs(5)}</p>` +
				`\n${tabs(4)}</container>` +
				`\n${tabs(3)}</credits>`;
			return output;
		}

		function buildTranscript() {
			diag && console.log("| building transcript");
			let output = `\n` +
				`\n${tabs(3)}<transcription>` +
				`\n${tabs(4)}<h2>Transcript</h2>` +
				`\n${tabs(4)}<container>` +
				`\n${tabs(5)}<aside>` +
				`\n${tabs(6)}<p>` +
				`\n${tabs(7)}${document.getElementById(`input-transcript`).value}` +
				`\n${tabs(6)}</p>` +
				`\n${tabs(5)}</aside>` +
				`\n${tabs(5)}<button type="button" onclick="location.href='https://www.dropbox.com/s/rprclv3buqbqehn/EB003__main--cc_en_captions.srt?dl=0'" value="download english captions">captions</button>` +
				`\n${tabs(5)}<button type="button" onclick="location.href='https://www.dropbox.com/s/3w1rg1r7hn5160u/EB003__main--cc_en_sub.srt?dl=0'" value="download english subtitles">subtitles</button>` +
				`\n${tabs(5)}<button type="button" onclick="document.location='/translations'" value="details about translations">info</button>` +
				`\n${tabs(4)}</container>` +
				`\n${tabs(3)}</transcription>`;

			return output;
		}

		function buildBonus() {
			diag && console.log("| building patreon bonus");
			let output = `\n` +
				`\n${tabs(3)}<bonus>` +
				`\n${tabs(4)}<h2>Bonus Material</h2>` +
				`\n${tabs(4)}<container>` +
				`\n${tabs(5)}<p>` +
				`\n${tabs(6)}<a href="https://patreon.com/emergentbeacon" class="support-link" title="patreon.com/emergentbeacon">Pledge now</a> for these behind the scenes exclusives!` +
				`\n${tabs(5)}</p>` +
				`\n${tabs(5)}<items>`;

			let patreonCount = Number.parseInt(document.getElementById("patreon-count").value);
			let patreonImage = document.getElementById("input-patreon-image").value;
			for (pa = 1; pa < patreonCount + 1; pa++) {
				let patreonURL = document.getElementById(`input-patreon${pa}-url`).value;
				let patreonTitle = document.getElementById(`input-patreon${pa}-title`).value;
				let patreonDuration = document.getElementById(`input-patreon${pa}-duration`).value;
				let imageOffset = (pa - 1) * -7;
				output +=
					`\n${tabs(6)}<bonus-entry>` +
					`\n${tabs(7)}<a href="${patreonURL}">` +
					`\n${tabs(8)}<img src="/assets/${patreonImage}" style="object-position: ${imageOffset}rem 0;">` +
					`\n${tabs(7)}</a>` +
					`\n${tabs(7)}<p>` +
					`\n${tabs(8)}<time datetime="${genDateTime(patreonDuration)}">${patreonDuration}</time><br>` +
					`\n${tabs(8)}<span>${patreonTitle}</span>` +
					`\n${tabs(7)}</p>` +
					`\n${tabs(6)}</bonus-entry>`;
				}
			
				output +=
					`\n${tabs(5)}</items>` +
					`\n${tabs(4)}</container>` +
					`\n${tabs(3)}</bonus>`;

			return output;
		}

		function buildFooter() {
			diag && console.log("| building footer");
			let output = `\n` +
				`\n${tabs(2)}<footnav>` +
				`\n${tabs(3)}<tooltip>` +
				`\n${tabs(4)}<a href="/videos/${document.getElementById(`input-prev-link`).value}.html">← Previous</a>` +
				`\n${tabs(4)}<span>${document.getElementById(`input-prev-title`).value}</span>` +
				`\n${tabs(3)}</tooltip>` +
				`\n${tabs(3)}<a href="#">TO TOP</a>` +
				`\n${tabs(3)}<tooltip>` +
				`\n${tabs(4)}<a href="/videos/${document.getElementById(`input-next-link`).value}.html">Next →</a>` +
				`\n${tabs(4)}<span>${document.getElementById(`input-next-title`).value}</span>` +
				`\n${tabs(3)}</tooltip>` +
				`\n${tabs(2)}</footnav>` +

				`\n\n${tabs(2)}<footer>` +
				`\n${tabs(3)}<p>` +
				`\n${tabs(4)}<a href="/home.html">home</a><a href="/videos.html">videos</a><a href="/music.html">music</a><a href="/about.html">about</a><br>` +
				`\n${tabs(4)}<a href="/finance.html">financial reports</a><a href="/media.html">media kits</a>` +
				`\n${tabs(3)}</p>` +
				`\n${tabs(3)}<logo>` +
				`\n${tabs(4)}<svg id="v1-7:organic" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 629.556 629.556">` +
				`\n${tabs(5)}<g id="shell">` +
				`\n${tabs(6)}<path d="M315.278,54.768c157.266,0,257.812,132.423,257.812,251.739,0,69.898-21.842,116.519-35.044,131.193-19.516,21.693-69.086,44.678-139.686,55.245-74.033,12.457-42.047,96.064-83.149,96.064-39.952,0-7.966-83.607-81.453-95.808-67.092-9.784-117.119-31.118-140.771-55.592-13.288-13.749-35.519-58.2-35.519-137.79,0-90.102,80.989-245.051,257.812-245.051Z"/>` +
				`\n${tabs(5)}</g>` +
				`\n${tabs(5)}<g id="interior">` +
				`\n${tabs(6)}<path d="M479.619,405.623c-7.956-17.388-35.482-18.367-35.482-34.859,0-9.255,11.786-12.784,27.882-12.784,20.229,0,36.868,6.96,45.182,14.55,6.614-18.266,9.507-39.998,9.507-65.593,0-119.849-91.189-211.43-211.43-211.43-119.266,0-211.43,91.582-211.43,218.828,0,22.437,2.619,41.824,8.51,58.409,8.233-7.673,24.99-14.764,45.409-14.764,16.096,0,27.882,3.53,27.882,12.784,0,16.492-27.526,17.471-35.482,34.859-2.749,6.009.352,16.893,12.877,23.416,33.185,16.74,82.314,24.299,152.234,24.299s118.625-7.428,151.725-24.446c12.298-6.538,15.345-17.304,12.615-23.269ZM315.278,410.801c-83.744,0-114.894-37.32-114.894-101.125,0-63.454,49.208-114.894,114.894-114.894,59.14,0,114.894,47.327,114.894,114.894,0,63.805-29.796,101.125-114.894,101.125Z"/>` +
				`\n${tabs(5)}</g>` +
				`\n${tabs(4)}</svg>` +
				`\n${tabs(3)}</logo>` +
				`\n${tabs(3)}<socials>` +
				`\n${tabs(4)}<div class="tooltip">` +
				`\n${tabs(5)}<a href="https://youtube.com/emergentbeacon">` +
				`\n${tabs(6)}<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 176 124">` +
				`\n${tabs(7)}<path d="M172.5,19.4h-.2c-2-7.6-8-13.6-15.6-15.7C143,0,88,0,88,0c0,0-55,0-68.8,3.7-7.6,2-13.5,8-15.6,15.7C0,33.2,0,62,0,62c0,0,0,28.8,3.7,42.6,2,7.6,8,13.6,15.6,15.7,13.7,3.7,68.8,3.7,68.8,3.7,0,0,55,0,68.8-3.7,7.6-2,13.5-8,15.6-15.7,3.7-13.8,3.7-42.6,3.7-42.6,0,0,0-28.8-3.7-42.6ZM70,88.2v-52.4l46,26.2-46,26.2Z"/>` +
				`\n${tabs(6)}</svg>` +
				`\n${tabs(5)}</a>` +
				`\n${tabs(5)}<span class="tooltip-text">youtube</span>` +
				`\n${tabs(4)}</div>` +
				`\n${tabs(4)}<div class="tooltip">` +
				`\n${tabs(5)}<a href="https://patreon.com/emergentbeacon">` +
				`\n${tabs(6)}<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 1080 1080" xml:space="preserve">` +
				`\n${tabs(7)}<path d="M1033.05,324.45c-0.19-137.9-107.59-250.92-233.6-291.7c-156.48-50.64-362.86-43.3-512.28,27.2 C106.07,145.41,49.18,332.61,47.06,519.31c-1.74,153.5,13.58,557.79,241.62,560.67c169.44,2.15,194.67-216.18,273.07-321.33 c55.78-74.81,127.6-95.94,216.01-117.82C929.71,603.22,1033.27,483.3,1033.05,324.45z"/>` +
				`\n${tabs(6)}</svg>` +
				`\n${tabs(5)}</a>` +
				`\n${tabs(5)}<span class="tooltip-text">patreon</span>` +
				`\n${tabs(4)}</div>` +
				`\n${tabs(4)}<div class="tooltip">` +
				`\n${tabs(5)}<a href="https://discord.emergentbeacon.com/">` +
				`\n${tabs(6)}<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 127.14 96.36">` +
				`\n${tabs(7)}<path d="M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.7,77.7,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22h0C129.24,52.84,122.09,29.11,107.7,8.07ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5-12.74,11.44-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z"/>` +
				`\n${tabs(6)}</svg>` +
				`\n${tabs(5)}</a>` +
				`\n${tabs(5)}<span class="tooltip-text">discord</span>` +
				`\n${tabs(4)}</div>` +
				`\n${tabs(4)}<div class="tooltip">` +
				`\n${tabs(5)}<a href="https://bsky.app/profile/brandthughes.bsky.social">` +
				`\n${tabs(6)}<svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 568 500.117">` +
				`\n${tabs(7)}<path d="M123.121,33.664c65.12,48.889,135.16,148.017,160.879,201.209,25.719-53.192,95.759-152.32,160.879-201.209,46.987-35.276,123.121-62.57,123.121,24.283,0,17.345-9.945,145.713-15.778,166.555-20.275,72.453-94.155,90.933-159.875,79.748,114.875,19.551,144.097,84.311,80.986,149.071-119.86,122.992-172.272-30.859-185.702-70.281-2.462-7.227-3.614-10.608-3.631-7.733-.017-2.875-1.169.506-3.631,7.733-13.43,39.422-65.842,193.273-185.702,70.281-63.111-64.76-33.889-129.52,80.986-149.071-65.72,11.185-139.599-7.295-159.875-79.748C9.945,203.659,0,75.292,0,57.946,0-28.906,76.134-1.612,123.121,33.664Z"/>` +
				`\n${tabs(6)}</svg>` +
				`\n${tabs(5)}</a>` +
				`\n${tabs(5)}<span class="tooltip-text">bluesky</span>` +
				`\n${tabs(4)}</div>` +
				`\n${tabs(4)}<div class="tooltip">` +
				`\n${tabs(5)}<a href="https://youtube.com/@BrandtHughes">` +
				`\n${tabs(6)}<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 176 124">` +
				`\n${tabs(7)}<path d="M172.3,19.4c-2-7.6-8-13.6-15.6-15.7C143,0,88,0,88,0c0,0-55,0-68.8,3.7-7.6,2-13.5,8-15.6,15.7C0,33.2,0,62,0,62c0,0,0,28.8,3.7,42.6,2,7.6,8,13.6,15.6,15.7,13.7,3.7,68.8,3.7,68.8,3.7,0,0,55,0,68.8-3.7,7.6-2,13.5-8,15.6-15.7,3.7-13.8,3.7-42.6,3.7-42.6,0,0,0-28.8-3.7-42.6h0ZM117.3,98c-1.8,1.8-3.9,2.7-6.4,2.7h-45c-3,0-5.4-.9-7.2-2.6-1.8-1.7-2.7-4.1-2.7-7.1v-3c0-3.4.8-6.7,2.4-9.8,1.6-3.1,4.3-6.5,8.3-10.3,4-3.7,9.5-8,16.7-13l.8-.6c4.1-2.9,7.1-5.1,9-6.6,1.9-1.5,3.2-2.9,4-4.1.8-1.3,1.2-2.6,1.2-4.2,0-2.6-1-4.7-2.9-6.3-1.9-1.6-4.4-2.4-7.6-2.4s-5.2.6-6.9,1.8c-1.7,1.2-3.4,2.8-5,4.7-.2.2-.4.5-.6.7-.5.6-1,1.1-1.5,1.7-1.1,1.5-2.1,2.6-3.1,3.3-1,.8-2.4,1.2-4.2,1.2s-4.4-.7-5.8-2.2c-1.5-1.5-2.2-3.5-2.2-6s1.5-6.8,4.4-10.3c2.5-2.9,6-5.5,10.4-7.7,4.4-2.2,9.5-3.3,15.2-3.3s10.1,1,14.3,3c4.2,2,7.5,4.8,10,8.4,2.4,3.6,3.7,7.8,3.8,12.6,0,3.3-.6,6.4-1.7,9.3-1.1,2.9-2.8,5.5-4.9,8-2.1,2.5-4.8,5-8.1,7.5l-1.1.8c-2.6,1.9-5.2,3.7-7.9,5.6-5.4,3.6-9.3,6.6-11.8,8.9-1.4,1.3-2.4,2.7-3,4.2l32.4-.4c2.5,0,4.7.9,6.4,2.7,1.8,1.8,2.7,3.9,2.7,6.4s-.9,4.7-2.7,6.4h0Z"/>` +
				`\n${tabs(6)}</svg>` +
				`\n${tabs(5)}</a>` +
				`\n${tabs(5)}<span class="tooltip-text">youtube 2</span>` +
				`\n${tabs(4)}</div>` +
				`\n${tabs(3)}</socials>` +
				`\n${tabs(2)}</footer>` +
				`\n${tabs(1)}</body>\n`;
			return output;
		}

		function buildScript() {
			diag && console.log("| building script");
			let output =
				`\n${tabs(1)}<script>`;

			output += buildScriptYTEmbed();
			output += buildScriptInfoSearch();
			output += buildScriptMediaSearch();
			output += buildScriptEventListeners();

			output +=
				`\n${tabs(1)}<\/script>` +
				`\n</html>`;

			return output;
		}
		function buildScriptYTEmbed() {
			let output =
				`\n${tabs(2)}// 2. This code loads the IFrame Player API code asynchronously.` +
				`\n${tabs(2)}var tag = document.createElement('script');` +
				`\n${tabs(2)}tag.src = "https://www.youtube.com/iframe_api";` +
				`\n${tabs(2)}var firstScriptTag = document.getElementsByTagName('script')[0];` +
				`\n${tabs(2)}firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n` +
				`\n${tabs(2)}// 3. This function creates an <iframe> (and YouTube player)` +
				`\n${tabs(2)}//    after the API code downloads.` +
				`\n${tabs(2)}var player;` +
				`\n${tabs(2)}function onYouTubeIframeAPIReady() {` +
				`\n${tabs(2)}player = new YT.Player('yt-player', {` +
				`\n${tabs(3)}height: '400',` +
				`\n${tabs(3)}width: '100%',` +
				`\n${tabs(3)}videoId: '${extractID(document.getElementById("input-url").value)}',` +
				`\n${tabs(3)}playerVars: {` +
				`\n${tabs(4)}'playsinline': 1` +
				`\n${tabs(3)}},` +
				`\n${tabs(3)}events: {` +
				`\n${tabs(4)}'onReady': onPlayerReady,` +
				`\n${tabs(4)}'onStateChange': onPlayerStateChange` +
				`\n${tabs(3)}}` +
				`\n${tabs(2)}});` +
				`\n${tabs(2)}}\n` +
				`\n${tabs(2)}// 4. The API will call this function when the video player is ready.` +
				`\n${tabs(2)}function onPlayerReady(event) {}` +
				`\n${tabs(2)}function onPlayerStateChange(event) {}\n` +
				`\n${tabs(2)}//generic seekTo function taking a player element and seconds as parameters` +
				`\n${tabs(2)}function playerSeekTo(player, seconds) {` +
				`\n${tabs(3)}player.seekTo(seconds);` +
				`\n${tabs(3)}player.scrollIntoView({` +
				`\n${tabs(4)}behavior: 'smooth',` +
				`\n${tabs(4)}block: 'start',` +
				`\n${tabs(4)}inline: 'nearest'` +
				`\n${tabs(3)}});` +
				`\n${tabs(2)}}\n`;
			return output;
		}
		function buildScriptInfoSearch() {
			let output =
				`\n${tabs(2)}const iSearch = document.getElementById("infoSearchBanner");\n` +
				`\n${tabs(2)}function infoSearch() {` +
				`\n${tabs(3)}let input = document.getElementById("infoInput");` +
				`\n${tabs(3)}let inputVal = input.value;` +
				`\n${tabs(3)}let container = document.documentElement;` +
				`\n${tabs(3)}let containerPos = container.scrollTop;` +
				`\n${tabs(3)}let anchor = document.getElementById('Info' + inputVal);\n` +
				`\n${tabs(3)}if (anchor == null) {` +
				`\n${tabs(4)}iSearch.classList.add("error");` +
				`\n${tabs(3)}} else {` +
				`\n${tabs(4)}anchor.scrollIntoView({` +
				`\n${tabs(5)}behavior: 'smooth',` +
				`\n${tabs(5)}block: 'start',` +
				`\n${tabs(5)}inline: 'nearest'` +
				`\n${tabs(4)}});` +
				`\n${tabs(4)}container.scrollTop = containerPos;` +
				`\n${tabs(3)}}` +
				`\n${tabs(2)}}\n`;

			return output;
		}
		function buildScriptMediaSearch() {
			let output =
				`\n${tabs(2)}const mSearch = document.getElementById("mediaSearchBanner");` +
				`\n${tabs(2)}function mediaSearch() {` +
				`\n${tabs(3)}let input = document.getElementById("mediaInput");` +
				`\n${tabs(3)}let inputVal = input.value;` +
				`\n${tabs(3)}let container = document.documentElement;` +
				`\n${tabs(3)}let containerPos = container.scrollTop;` +
				`\n${tabs(3)}let anchor = document.getElementById('Media' + inputVal);\n` +
				`\n${tabs(3)}if (anchor == null) {` +
				`\n${tabs(4)}mSearch.classList.add("error");` +
				`\n${tabs(3)}} else {` +
				`\n${tabs(4)}anchor.scrollIntoView({` +
				`\n${tabs(5)}behavior: 'smooth',` +
				`\n${tabs(5)}block: 'start',` +
				`\n${tabs(5)}inline: 'nearest'` +
				`\n${tabs(4)}});` +
				`\n${tabs(4)}container.scrollTop = containerPos;` +
				`\n${tabs(3)}}` +
				`\n${tabs(2)}}\n`;
			
			return output;
		}
		function buildScriptEventListeners() {
			let output = 
				`\n${tabs(2)}// source lookup behavior: disable form submit on "Enter," replace with function` +
				`\n${tabs(2)}document.getElementById("infoInput").addEventListener("keydown", function (e) {` +
				`\n${tabs(3)}if (e.code === "Enter") {` +
				`\n${tabs(4)}e.preventDefault();` +
				`\n${tabs(4)}infoSearch();` +
				`\n${tabs(3)}}` +
				`\n${tabs(2)}});` +
				`\n${tabs(2)}document.getElementById("mediaInput").addEventListener("keydown", function (e) {` +
				`\n${tabs(3)}if (e.code === "Enter") {` +
				`\n${tabs(4)}e.preventDefault();` +
				`\n${tabs(4)}mediaSearch();` +
				`\n${tabs(3)}}` +
				`\n${tabs(2)}});\n` +
				`\n${tabs(2)}// remove css color animation class when animation finishes` +
				`\n${tabs(2)}iSearch.addEventListener("animationend", listener, false);` +
				`\n${tabs(2)}mSearch.addEventListener("animationend", listener, false);` +
				`\n${tabs(2)}function listener(event) {` +
				`\n${tabs(3)}switch (event.type) {` +
				`\n${tabs(4)}case "animationend":` +
				`\n${tabs(5)}mSearch.classList.remove("error");` +
				`\n${tabs(5)}iSearch.classList.remove("error");` +
				`\n${tabs(5)}break;` +
				`\n${tabs(3)}}` +
				`\n${tabs(2)}}`;

			return output;
		}

		function addNewField(type, group) {
			try {
				document.getElementById("processing").classList.remove("hidden");
				diag && console.log("| creating new " + type + " field");

				// create a field for another source group
				if (type == "correction") {
					let corrCount = document.getElementById(`btn-correction${group}`).value;
					let corrNum = Number(corrCount) + 1;
					corrCount = corrNum;

					const row = document.createElement("row");
					row.innerHTML =
						`${tabs(8)}<label></label>` +
						`\n${tabs(8)}<input id="input-${type}${group}-tcode${corrNum}" autocomplete="off"><input id="input-${type}${group}-details${corrNum}" autocomplete="off">`;

					let container = document.getElementById(type + group + "-rows");
					container.appendChild(row);
					document.getElementById(`btn-correction${group}`).value = corrNum;
				} else if (type == "correction-group") {
					console.log("creating correction group, in loop");
					let count = document.getElementById(type + "-count");
					let newCount = group + 1;
					count.value = newCount;
					console.log("group: " + group + ", newCount: " + newCount);

					const newGroup = document.createElement("div");
					newGroup.id = `correction${newCount}-group`;

					console.log("prepping innerHTML");
					
					newGroup.innerHTML =
						`${tabs(8)}<div id="correction${newCount}-rows" class="rowgroup">` +
						`\n${tabs(9)}<row>` +
						`\n${tabs(10)}<label>Correction:</label>` +
						`\n${tabs(10)}<input id="input-correction${newCount}-tcode1" autocomplete="off"><input id="input-correction${newCount}-details1" autocomplete="off">` +
						`\n${tabs(9)}</row>` +
						`\n${tabs(8)}</div>` +
						`\n${tabs(8)}<row>` +
						`\n${tabs(9)}<label>Correction credit:</label>` +
						`\n${tabs(9)}<input id="input-correction${newCount}-credit" autocomplete="off">` +
						`\n${tabs(8)}</row>` +
						`\n${tabs(8)}<button-row id="correction-buttons">` +
						`\n${tabs(9)}<button id="btn-correction${newCount}" class="add-new-button" value="1" onclick="addNewField('correction',${newCount})">add correction</button>` +
						`\n${tabs(9)}<button id="btn-correction${newCount}-group" class="add-new-button" value="1" onclick="addNewField('correction-group',${newCount})">new correction group</button>` +
						`\n${tabs(8)}</button-row>`;

					console.log("deleting button");
					document.getElementById(`btn-correction${group}-group`).remove();
					console.log("button deleted, defining container");
					let container = document.getElementById("corrections");
					console.log("appending child");
					container.appendChild(newGroup);
					console.log("child appended");
				} else if (type == "patreon") {
					let count = document.getElementById(type + "-count");
					let countNum = Number.parseInt(count.value);
					let newCount = countNum + 1;
					count.value = newCount;

					const row1 = document.createElement("row");
					row1.innerHTML =
						`${tabs(8)}<label>Patreon URL:</label>` +
						`\n${tabs(8)}<input id="input-${type}${newCount}-url" autocomplete="off">`;

					const row2 = document.createElement("row");
					row2.innerHTML =
						`${tabs(8)}<label>Patreon Title:</label>` +
						`\n${tabs(8)}<input id="input-${type}${newCount}-title" autocomplete="off">`;

					const row3 = document.createElement("row");
					row3.innerHTML =
						`${tabs(8)}<label>Patreon Duration:</label>` +
						`\n${tabs(8)}<input id="input-${type}${newCount}-duration" autocomplete="off">`;

					let container = document.getElementById(type + "-container");
					container.appendChild(row1);
					container.appendChild(row2);
					container.appendChild(row3);
				} else if (type == "credit") {
					let count = document.getElementById(type + "-count");
					console.log("count: " + count);
					let countNum = Number.parseInt(count.value);
					console.log("countNum: " + countNum);
					let newCount = countNum + 1;
					console.log("newCount: " + newCount);
					count.value = newCount;

					const row1 = document.createElement("row");
					row1.innerHTML =
						`${tabs(8)}<label>Credit (name):</label>` +
						`\n${tabs(8)}<input id="input-${type}${newCount}-name" autocomplete="off">`;

					const row2 = document.createElement("row");
					row2.innerHTML =
						`${tabs(8)}<label>Credit (role):</label>` +
						`\n${tabs(8)}<input id="input-${type}${newCount}-role" autocomplete="off">`;

					let container = document.getElementById(type + "-container");
					container.appendChild(row1);
					container.appendChild(row2);
				}
				

				document.getElementById("processing").classList.add("hidden");
			} catch(err) {
				console.log(">!< ERROR: " + err);
			}

		</script>
	</body>
		}

		function urlSanitize(url) {
			if (url.indexOf("https://www.") != -1) { return url.slice(12) }
			else if (url.indexOf("https://") != -1) { return url.slice(8) }
			else if (url.indexOf("http://www.") != -1) { return url.slice(11) }
			else if (url.indexOf("http://") != -1) { return url.slice(7) }
			else if (url.indexOf("www.") != -1) { return url.slice(4) }
			else { return url }
		}

		function extractID(url) {
			let ID = url;
			if (url.indexOf("?si=") != -1) { ID = url.slice(0,-20) }
			return ID.slice(-11);
		}

		function tabs(num) {
			let x = `	`;
			let output = "";
			for (i = 0; i < num; i++) { output += x; }
			return output;
		}

		function genDateTime(t) {
			let S, M, H;
			S = t.slice(-2) + "S";
			(t.length > 3) ? M = t.slice(-5,-3) + "M" : M = "";
			(t.length > 5) ? H = t.slice(0,1) + "H" : H = "";
			let output = `PT${H}${M}${S}`;
			return output;
		}

</html>